clc;
clear;
close all;

%loading in data
rawData = load("2025_09_23_001_Torque_RW_5mNm.txt");

%assigning columns
time = rawData(1:700,1).*(10^-3); %convert from ms to s
commanded_torque = rawData(1:700,2); %baseline to compare
angular_velocity = rawData(1:700,3).*(-1) * (2*pi / 60); %multiplied by -1
current = rawData(1:700,4);

%finding instantanous angular acceleration
angular_acceleration = angular_velocity ./ time; %rad/s^2

%finding torque using current since it is mentioned in 3.3a
torque_const = 25.5; %mNm/A, given in the experimental procedures
torque = (current*torque_const); %mNm

%Equation for angular momentum
MoI = torque .* angular_acceleration; %Nm/s^2

%finding average angular acceleration
angular_velocity_smooth = sgolayfilt(angular_velocity, 3, 51);
angular_acceleration_smooth = gradient(angular_velocity_smooth, time);

%moment of inertia
MoI_smooth = torque / angular_acceleration_smooth;

%graphing time vs calculated torque
nexttile
hold on
plot(time,torque)
plot(time,commanded_torque) %baseline
ylabel("Torque (Nm)");
xlabel("Time (s)");
title("Torque vs. Time");
grid on;
hold off

%graphing angular velocity vs time
nexttile
hold on
plot(time,angular_velocity.*-1, 'g', time, angular_velocity_smooth.*-1, '-k');
ylabel("Angular Velocity (rad/s)");
xlabel("Time (s)")
title("Angular Velocity vs Time");
grid on
hold off


%graphing angular acceleration vs time
nexttile
plot(time,-angular_acceleration_smooth);
ylabel('Angular Acceleration (rad/s^2)');
xlabel("Time (s)");
title("Angular Acceleraion vs Time");
grid on;

%graphing MOI
nexttile
hold on;
%plot(time, torque);
plot(time, MoI_smooth);
ylabel('Moment of Inertia (kg m^2)');
xlabel("Time (s)");
title("Moment of Inertia vs Time");
grid on;
