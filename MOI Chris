clc;
clear;
close all;

%loading in data
rawData = load("2025_09_23_001_Torque_RW_5mNm.txt");

%assigning columns
time = rawData(1:700,1).*(10^-3); %convert from ms to s
commanded_torque = rawData(1:700,2); %baseline to compare
angular_velocity = rawData(1:700,3).*(-1) * (2*pi / 60); %multiplied by -1
current = rawData(1:700,4);

%finding instantanous angular acceleration
%angular_acceleration = angular_velocity ./ time; %rad/s^2

%finding torque using current since it is mentioned in 3.3a
torque_const = 25.5; %mNm/A, given in the experimental procedures
torque = (current*torque_const); %Nm
threshold = 2.5;
torque_active = find(torque > threshold);
commanded_torque_c = commanded_torque(torque_active(1):torque_active(end)).* (10^-3);
torque_c = torque(torque_active(1):torque_active(end)).* (10^-3);
time_c = time(torque_active(1):torque_active(end));
angular_velocity_c = angular_velocity(torque_active(1):torque_active(end));

%Equation for angular momentum
%MoI = torque .* angular_acceleration; %Nm/s^2

%finding average angular acceleration
%angular_velocity_smooth = sgolayfilt(angular_velocity_c, 3, 51);
angular_velocity_smooth = polyfit(time_c, angular_velocity_c, 1);
%angular_acceleration_smooth = gradient(angular_velocity_smooth, time_c);
angular_acceleration_smooth = polyval(angular_velocity_smooth, time_c);

%moment of inertia
MoI_smooth = torque_c / angular_acceleration_smooth;

%graphing time vs calculated torque
nexttile
hold on
plot(time_c,torque_c)
plot(time_c,commanded_torque_c) %baseline
ylabel("Torque (Nm)");
xlabel("Time (s)");
title("Torque vs. Time");
grid on;
hold off

%graphing angular velocity vs time
nexttile
hold on
plot(time_c, -angular_acceleration_smooth);
plot(time_c,angular_velocity_c.*-1, 'g');
ylabel("Angular Velocity (rad/s)");
xlabel("Time (s)")
title("Angular Velocity vs Time");
grid on
hold off


%graphing angular acceleration vs time
nexttile
plot(time_c,-angular_acceleration_smooth);
ylabel('Angular Acceleration (rad/s^2)');
xlabel("Time (s)");
title("Angular Acceleraion vs Time");
grid on;

%graphing MOI
nexttile
plot(time_c, MoI_smooth);
ylabel('Moment of Inertia (kg m^2)');
xlabel("Time (s)");
title("Moment of Inertia vs Time");
